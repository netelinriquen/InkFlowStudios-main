<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - Ink Flow</title>
    <link rel="stylesheet" href="../assets/css/styles.css">
    <style>
        .admin-container { max-width: 1200px; margin: 2rem auto; padding: 2rem; }
        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .stat-card { background: var(--secondary-dark); padding: 1.5rem; border-radius: 8px; text-align: center; }
        .stat-number { font-size: 2rem; font-weight: bold; color: var(--accent-red); }
        .data-section { background: var(--secondary-dark); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem; }
        .btn-logout { background: #dc3545; color: white; padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="../index.html" class="logo">INK FLOW ADMIN</a>
            <div class="admin-header">
                <h1>Dashboard Administrativo</h1>
                <button class="btn-logout" onclick="logout()">Sair</button>
            </div>
        </nav>
    </header>

    <main>
        <div class="admin-container">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-agendamentos">0</div>
                    <div>Total Agendamentos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-usuarios">0</div>
                    <div>Total Usuários</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="agendamentos-hoje">0</div>
                    <div>Agendamentos Hoje</div>
                </div>
            </div>

            <div class="data-section">
                <h3>Agendamentos Recentes</h3>
                <div id="agendamentos-list"></div>
            </div>

            <div class="data-section">
                <h3>Usuários Cadastrados</h3>
                <div id="usuarios-list"></div>
            </div>
        </div>
    </main>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="../assets/js/supabase-agendamento.js"></script>
    <script>
        // Verificar se é admin
        const adminData = JSON.parse(localStorage.getItem('adminLoginData') || '{}');
        if (!adminData.isAdmin) {
            alert('Acesso negado!');
            window.location.href = 'login.html';
        }

        async function carregarDados() {
            try {
                // Carregar agendamentos
                const agendamentos = await window.supabaseAgendamento.listarAgendamentos();
                document.getElementById('total-agendamentos').textContent = agendamentos.data.length;
                
                // Agendamentos hoje
                const hoje = new Date().toISOString().split('T')[0];
                const agendamentosHoje = agendamentos.data.filter(a => a.data_agendamento === hoje);
                document.getElementById('agendamentos-hoje').textContent = agendamentosHoje.length;
                
                // Mostrar agendamentos
                const agendamentosList = document.getElementById('agendamentos-list');
                agendamentosList.innerHTML = agendamentos.data.slice(0, 5).map(a => `
                    <div style="padding: 1rem; border-bottom: 1px solid #333;">
                        <strong>${a.nome_cliente}</strong> - ${a.servico}<br>
                        <small>${a.data_agendamento} às ${a.horario} | ${a.status}</small>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Erro ao carregar dados:', error);
            }
        }

        function logout() {
            localStorage.removeItem('adminLoginData');
            localStorage.removeItem('adminLoggedIn');
            window.location.href = 'login.html';
        }

        // Carregar dados ao iniciar
        carregarDados();
    </script>
</body>
</html>